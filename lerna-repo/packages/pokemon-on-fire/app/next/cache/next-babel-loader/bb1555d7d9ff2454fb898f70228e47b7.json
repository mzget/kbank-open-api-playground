{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nvar __jsx = React.createElement;\nimport React from \"react\";\nexport default function KPayment(props) {\n  var attrs = props.attrs,\n      formAction = props.formAction,\n      onFinish = props.onFinish,\n      onError = props.onError,\n      onProcess = props.onProcess,\n      _props$debug = props.debug,\n      debug = _props$debug === void 0 ? false : _props$debug;\n\n  function formSubmit(_x) {\n    return _formSubmit.apply(this, arguments);\n  }\n\n  function _formSubmit() {\n    _formSubmit = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee(event) {\n      var formData, token, paymentMethods, saveCard, data, url, resp, _result, _result2;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              event.preventDefault();\n              formData = new FormData(event.target);\n              token = formData.get(\"token\");\n              paymentMethods = formData.get(\"paymentMethods\");\n              saveCard = formData.get(\"saveCard\");\n              data = {\n                token: token,\n                paymentMethods: paymentMethods,\n                saveCard: saveCard\n              };\n              url = formAction;\n              _context.next = 9;\n              return fetch(url, {\n                method: \"POST\",\n                body: _JSON$stringify(data),\n                headers: {\n                  \"Content-Type\": \"application/json\"\n                }\n              });\n\n            case 9:\n              resp = _context.sent;\n\n              if (!resp.ok) {\n                _context.next = 17;\n                break;\n              }\n\n              _context.next = 13;\n              return resp.json();\n\n            case 13:\n              _result = _context.sent;\n              if (onFinish) onFinish(_result);\n              _context.next = 21;\n              break;\n\n            case 17:\n              _context.next = 19;\n              return resp.json();\n\n            case 19:\n              _result2 = _context.sent;\n              if (onError) onError(_JSON$stringify(_result2));\n\n            case 21:\n              if (onProcess) onProcess();\n\n            case 22:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n    return _formSubmit.apply(this, arguments);\n  }\n\n  React.useEffect(function () {\n    var script = document.createElement(\"script\");\n    script.src = attrs.scriptUrl;\n    script.setAttribute(\"data-apikey\", attrs.apiKey);\n    script.setAttribute(\"data-amount\", attrs.amount);\n    script.setAttribute(\"data-currency\", attrs.currency);\n    script.setAttribute(\"data-payment-methods\", attrs.paymentMethods);\n    script.setAttribute(\"data-name\", attrs.shopName);\n    script.type = \"text/javascript\";\n    script.async = true;\n\n    script.onload = function (ev) {\n      if (checkoutForm) {\n        if (debug) {\n          console.log(\"payment-container create new\");\n        }\n\n        window.KPayment.create();\n      }\n    };\n\n    var checkoutForm = document.getElementById(\"checkout-form\");\n\n    if (checkoutForm) {\n      checkoutForm.appendChild(script);\n      checkoutForm.addEventListener(\"submit\", formSubmit);\n    }\n\n    return function () {\n      if (checkoutForm) {\n        checkoutForm.removeChild(script);\n        checkoutForm.removeEventListener(\"submit\", formSubmit);\n        var paymentContainer = document.querySelector(\".payment-container\");\n\n        if (paymentContainer) {\n          document.body.removeChild(paymentContainer);\n        }\n      }\n    };\n  }, []);\n  return __jsx(\"form\", {\n    id: \"checkout-form\"\n  });\n}","map":null,"metadata":{},"sourceType":"module"}